<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”” ×‘×“×™×§×ª ×”×ª×¨××•×ª ××ª×§×“××ª</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f8f9fa;
        }
        .card { 
            background: white; 
            border-radius: 15px; 
            padding: 25px; 
            margin: 15px 0; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            margin: 8px; 
            border-radius: 8px; 
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        button:hover { 
            background: #0056b3; 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }
        button.success { background: #28a745; }
        button.success:hover { background: #1e7e34; }
        button.warning { background: #ffc107; color: #212529; }
        button.warning:hover { background: #e0a800; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        
        .log { 
            background: #f8f9fa; 
            border: 2px solid #dee2e6; 
            border-radius: 8px; 
            padding: 15px; 
            max-height: 500px; 
            overflow-y: auto; 
            font-family: 'Courier New', monospace; 
            white-space: pre-wrap;
            font-size: 13px;
            line-height: 1.4;
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .info { color: #17a2b8; }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 8px;
        }
        .status-green { background: #28a745; }
        .status-red { background: #dc3545; }
        .status-yellow { background: #ffc107; }
        
        .notification-bell {
            width: 40px;
            height: 40px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            position: relative;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ”” ××¨×›×– ×‘×“×™×§×ª ×”×ª×¨××•×ª ××ª×§×“×</h1>
        <p>×›×œ×™ ××§×™×£ ×œ×‘×“×™×§×” ×•×ª×™×§×•×Ÿ ×©×œ ××¢×¨×›×ª ×”×”×ª×¨××•×ª</p>
        
        <div style="display: flex; align-items: center; gap: 20px; margin: 20px 0;">
            <span>×¡×˜×˜×•×¡ ××¢×¨×›×ª:</span>
            <div>Firebase <span id="firebase-status" class="status-indicator status-red"></span></div>
            <div>Service Worker <span id="sw-status" class="status-indicator status-red"></span></div>
            <div>×”×¨×©××•×ª <span id="permission-status" class="status-indicator status-red"></span></div>
            <div>×©×¨×ª <span id="server-status" class="status-indicator status-red"></span></div>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ§ª ×‘×“×™×§×•×ª ××¢×¨×›×ª</h3>
        <button onclick="checkSystemStatus()">ğŸ“Š ×‘×“×™×§×ª ×¡×˜×˜×•×¡ ×›×œ×œ×™</button>
        <button onclick="testNotificationDisplay()">ğŸ¨ ×‘×“×™×§×ª ×”×¦×’×ª ×”×ª×¨××•×ª</button>
        <button onclick="testNotificationButton()">ğŸ”” ×‘×“×™×§×ª ×›×¤×ª×•×¨ ×”×ª×¨××•×ª</button>
        <button onclick="testBrowserNotification()">ğŸŒ ×”×ª×¨××ª ×“×¤×“×¤×Ÿ</button>
        <button onclick="testCustomNotification()">ğŸ¯ ×”×ª×¨××” ××•×ª×××ª</button>
        <button onclick="testVanillaNotification()">ğŸ¦ ×”×ª×¨××” Vanilla JS</button>
    </div>

    <div class="card">
        <h3>ğŸ® ×¡×™××•×œ×¦×™×™×ª ×”×ª×¨××•×ª</h3>
        <button class="success" onclick="simulateFollowNotification()">ğŸ‘¥ ×¢×•×§×‘ ×—×“×©</button>
        <button class="warning" onclick="simulateShareNotification()">ğŸ“¤ ×©×™×ª×•×£ ××××¨</button>
        <button class="info" onclick="simulateCommentNotification()">ğŸ’¬ ×ª×’×•×‘×” ×—×“×©×”</button>
        <button class="danger" onclick="simulateErrorNotification()">âŒ ×©×’×™××”</button>
    </div>

    <div class="card">
        <h3>ğŸ”§ ×›×œ×™ ×ª×™×§×•×Ÿ</h3>
        <button onclick="fixNotificationButton()">ğŸ”¨ ×ª×§×Ÿ ×›×¤×ª×•×¨ ×”×ª×¨××•×ª</button>
        <button onclick="resetServiceWorker()">ğŸ”„ ××ª×—×œ Service Worker</button>
        <button onclick="requestPermissions()">ğŸ”’ ×‘×§×© ×”×¨×©××•×ª</button>
        <button onclick="clearAllNotifications()">ğŸ—‘ï¸ × ×§×” ×›×œ ×”×”×ª×¨××•×ª</button>
    </div>

    <div class="card">
        <h3>ğŸ“Š ×ª×•×¦××•×ª ×•×œ×•×’×™×</h3>
        <div style="margin-bottom: 10px;">
            <button onclick="clearLog()">ğŸ—‘ï¸ × ×§×” ×œ×•×’</button>
            <button onclick="exportLog()">ğŸ“„ ×™×™×¦× ×œ×•×’</button>
            <button onclick="copyLog()">ğŸ“‹ ×”×¢×ª×§ ×œ×•×’</button>
        </div>
        <div id="log" class="log"></div>
    </div>

    <!-- ××–×•×¨ ×”×“××™×” ×©×œ navbar -->
    <div class="card">
        <h3>ğŸ­ ×”×“××™×” ×©×œ ×›×¤×ª×•×¨ ×”×ª×¨××•×ª</h3>
        <div style="background: #343a40; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
            <span style="color: white;">Navigation Bar Demo</span>
            <div style="display: flex; align-items: center; gap: 10px;">
                <button id="notifications-btn" class="notification-bell">ğŸ””</button>
            </div>
        </div>
    </div>

    <!-- ×˜×¢×™× ×ª ×¡×§×¨×™×¤×˜×™× -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/shared/initServerUrl.js"></script>
    <script src="js/shared/data.js"></script>
    <script src="js/shared/ajaxCalls.js"></script>
    <script src="js/firebaseConfig.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/notification-recovery.js"></script>

    <script>
        // ×”×’×“×¨×ª ××©×ª××© ×œ×‘×“×™×§×”
        window.currentUser = { id: 1021, name: "rubi", email: "rubi@gmail.com" };
        
        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('he-IL');
            const className = type;
            logEl.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('×œ×•×’ × ×•×§×”', 'info');
        }

        function copyLog() {
            const logContent = document.getElementById('log').innerText;
            navigator.clipboard.writeText(logContent).then(() => {
                log('×œ×•×’ ×”×•×¢×ª×§ ×œ×œ×•×—', 'success');
            });
        }

        function exportLog() {
            const logContent = document.getElementById('log').innerText;
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `notification-log-${new Date().toISOString().slice(0,19)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            log('×œ×•×’ ×™×•×¦× ×œ×§×•×‘×¥', 'success');
        }

        // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ××™× ×“×™×§×˜×•×¨×™×
        function updateStatus(indicator, isGood) {
            const element = document.getElementById(indicator + '-status');
            if (element) {
                element.className = `status-indicator ${isGood ? 'status-green' : 'status-red'}`;
            }
        }

        // ×‘×“×™×§×ª ×¡×˜×˜×•×¡ ×›×œ×œ×™
        async function checkSystemStatus() {
            log('ğŸ” ×‘×•×“×§ ×¡×˜×˜×•×¡ ×›×œ×œ×™ ×©×œ ×”××¢×¨×›×ª...', 'info');
            
            // ×‘×“×™×§×ª Firebase
            try {
                if (typeof firebaseConfig !== 'undefined') {
                    log('âœ… Firebase Config ×–××™×Ÿ', 'success');
                    updateStatus('firebase', true);
                } else {
                    log('âŒ Firebase Config ×œ× ×–××™×Ÿ', 'error');
                    updateStatus('firebase', false);
                }
            } catch (e) {
                log('âŒ ×©×’×™××” ×‘×‘×“×™×§×ª Firebase', 'error');
                updateStatus('firebase', false);
            }

            // ×‘×“×™×§×ª Service Worker
            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                if (registrations.length > 0) {
                    log(`âœ… × ××¦××• ${registrations.length} Service Workers`, 'success');
                    updateStatus('sw', true);
                } else {
                    log('âš ï¸ ×œ× × ××¦××• Service Workers', 'warning');
                    updateStatus('sw', false);
                }
            } catch (e) {
                log('âŒ ×©×’×™××” ×‘×‘×“×™×§×ª Service Worker', 'error');
                updateStatus('sw', false);
            }

            // ×‘×“×™×§×ª ×”×¨×©××•×ª
            if (Notification.permission === 'granted') {
                log('âœ… ×”×¨×©××•×ª ×”×ª×¨××•×ª ×××•×©×¨×•×ª', 'success');
                updateStatus('permission', true);
            } else {
                log(`âš ï¸ ×”×¨×©××•×ª ×”×ª×¨××•×ª: ${Notification.permission}`, 'warning');
                updateStatus('permission', false);
            }

            // ×‘×“×™×§×ª ×©×¨×ª
            try {
                const response = await fetch('https://localhost:7065/api/Notifications/status');
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… ×©×¨×ª ×¤×•×¢×œ: ${data.status}`, 'success');
                    updateStatus('server', true);
                } else {
                    log(`âŒ ×©×¨×ª ×”×—×–×™×¨: ${response.status}`, 'error');
                    updateStatus('server', false);
                }
            } catch (e) {
                log('âŒ ×©×’×™××” ×‘×—×™×‘×•×¨ ×œ×©×¨×ª', 'error');
                updateStatus('server', false);
            }

            log('ğŸ¯ ×‘×“×™×§×ª ×¡×˜×˜×•×¡ ×”×•×©×œ××”', 'info');
        }

        // ×‘×“×™×§×ª ×”×¦×’×ª ×”×ª×¨××•×ª
        function testNotificationDisplay() {
            log('ğŸ¨ ×‘×•×“×§ ×”×¦×’×ª ×”×ª×¨××•×ª...', 'info');
            
            if (typeof showCustomNotification === 'function') {
                log('âœ… ×¤×•× ×§×¦×™×™×ª showCustomNotification ×–××™× ×”', 'success');
                showCustomNotification('×‘×“×™×§×ª ×”×ª×¨××”', '×–×•×”×™ ×”×ª×¨××ª ×‘×“×™×§×” ×œ×•×•×“× ×©×”×”×¦×’×” ×¢×•×‘×“×ª', { url: '#' });
                log('ğŸ“¤ ×”×ª×¨××ª ×‘×“×™×§×” × ×©×œ×—×”', 'info');
            } else {
                log('âŒ ×¤×•× ×§×¦×™×™×ª showCustomNotification ×œ× ×–××™× ×”', 'error');
            }
        }

        // ×‘×“×™×§×ª ×›×¤×ª×•×¨ ×”×ª×¨××•×ª
        function testNotificationButton() {
            log('ğŸ”” ×‘×•×“×§ ×›×¤×ª×•×¨ ×”×ª×¨××•×ª...', 'info');
            
            const btn = document.getElementById('notifications-btn');
            if (btn) {
                log('âœ… ×›×¤×ª×•×¨ ×”×ª×¨××•×ª × ××¦×', 'success');
                log(`ğŸ“ ×¡×˜×™×™×œ: ${btn.style.display}`, 'info');
                log(`ğŸ“ ××™×¨×•×¢×™×: ${btn.onclick ? '×™×©' : '××™×Ÿ'}`, btn.onclick ? 'success' : 'warning');
                
                // × ×¡×” ×œ×”×¤×¢×™×œ ××ª ×”×¤×•× ×§×¦×™×” ×œ×ª×™×§×•×Ÿ
                if (typeof showNotificationButtonImmediate === 'function') {
                    showNotificationButtonImmediate();
                    log('ğŸ”§ ×”×•×¤×¢×œ×” ×¤×•× ×§×¦×™×™×ª ×ª×™×§×•×Ÿ ×”×›×¤×ª×•×¨', 'info');
                }
            } else {
                log('âŒ ×›×¤×ª×•×¨ ×”×ª×¨××•×ª ×œ× × ××¦×', 'error');
            }
        }

        // ×”×ª×¨××ª ×“×¤×“×¤×Ÿ
        function testBrowserNotification() {
            log('ğŸŒ ×‘×•×“×§ ×”×ª×¨××ª ×“×¤×“×¤×Ÿ...', 'info');
            
            if (Notification.permission === 'granted') {
                const notification = new Notification('×”×ª×¨××ª ×‘×“×™×§×” ××”×“×¤×“×¤×Ÿ', {
                    body: '×–×•×”×™ ×”×ª×¨××” ×™×©×™×¨×” ××”×“×¤×“×¤×Ÿ',
                    icon: '/public/newsSite.png',
                    tag: 'browser-test'
                });
                
                notification.onclick = () => {
                    log('ğŸ‘† × ×œ×—×¥ ×¢×œ ×”×ª×¨××ª ×”×“×¤×“×¤×Ÿ', 'info');
                    notification.close();
                };
                
                log('âœ… ×”×ª×¨××ª ×“×¤×“×¤×Ÿ × ×©×œ×—×”', 'success');
            } else {
                log('âŒ ××™×Ÿ ×”×¨×©××•×ª ×œ×”×ª×¨××•×ª ×“×¤×“×¤×Ÿ', 'error');
            }
        }

        // ×”×ª×¨××” ××•×ª×××ª
        function testCustomNotification() {
            log('ğŸ¯ ×‘×•×“×§ ×”×ª×¨××” ××•×ª×××ª...', 'info');
            
            if (typeof showCustomNotification === 'function') {
                showCustomNotification(
                    '×”×ª×¨××” ××•×ª×××ª ××ª×§×“××ª', 
                    '×–×•×”×™ ×”×ª×¨××” ×¢× ×¢×™×¦×•×‘ ××•×ª×× ×•×›×¤×ª×•×¨×™ ×¤×¢×•×œ×”', 
                    { url: 'https://example.com' }
                );
                log('âœ… ×”×ª×¨××” ××•×ª×××ª ×”×•×¦×’×”', 'success');
            } else {
                log('âŒ ×¤×•× ×§×¦×™×™×ª ×”×ª×¨××” ××•×ª×××ª ×œ× ×–××™× ×”', 'error');
            }
        }

        // ×”×ª×¨××” Vanilla JS
        function testVanillaNotification() {
            log('ğŸ¦ ×‘×•×“×§ ×”×ª×¨××” Vanilla JS...', 'info');
            
            if (typeof showVanillaNotification === 'function') {
                showVanillaNotification(
                    '×”×ª×¨××” Vanilla JS', 
                    '×–×•×”×™ ×”×ª×¨××” ×‘×˜×›× ×•×œ×•×’×™×™×ª JavaScript ×’×•×œ××™×ª', 
                    { url: 'https://example.com' }
                );
                log('âœ… ×”×ª×¨××” Vanilla JS ×”×•×¦×’×”', 'success');
            } else {
                log('âŒ ×¤×•× ×§×¦×™×™×ª Vanilla JS ×œ× ×–××™× ×”', 'error');
            }
        }

        // ×¡×™××•×œ×¦×™×•×ª ×”×ª×¨××•×ª
        function simulateFollowNotification() {
            log('ğŸ‘¥ ×¡×™××•×œ×¦×™×™×ª ×”×ª×¨××ª ×¢×•×§×‘ ×—×“×©...', 'info');
            if (typeof showCustomNotification === 'function') {
                showCustomNotification('×¢×•×§×‘ ×—×“×©!', '××œ×™ ×›×”×Ÿ ×”×—×œ ×œ×¢×§×•×‘ ××—×¨×™×š', { url: '/profile/eli' });
            }
        }

        function simulateShareNotification() {
            log('ğŸ“¤ ×¡×™××•×œ×¦×™×™×ª ×”×ª×¨××ª ×©×™×ª×•×£...', 'info');
            if (typeof showCustomNotification === 'function') {
                showCustomNotification('×©×™×ª×•×£ ×—×“×©!', '×¨×•×ª× ×œ×•×™ ×©×™×ª×¤×” ××ª ×”××××¨ ×©×œ×š "×˜×›× ×•×œ×•×’×™×•×ª ×—×“×©×•×ª"', { url: '/article/123' });
            }
        }

        function simulateCommentNotification() {
            log('ğŸ’¬ ×¡×™××•×œ×¦×™×™×ª ×”×ª×¨××ª ×ª×’×•×‘×”...', 'info');
            if (typeof showCustomNotification === 'function') {
                showCustomNotification('×ª×’×•×‘×” ×—×“×©×”!', '×“× ×™ ×™×©×¨××œ ×”×’×™×‘ ×¢×œ ×”××××¨ ×©×œ×š', { url: '/article/456#comments' });
            }
        }

        function simulateErrorNotification() {
            log('âŒ ×¡×™××•×œ×¦×™×™×ª ×”×ª×¨××ª ×©×’×™××”...', 'info');
            if (typeof showCustomNotification === 'function') {
                showCustomNotification('×©×’×™××” ×‘××¢×¨×›×ª', '××™×¨×¢×” ×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×. × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.', null);
            }
        }

        // ×›×œ×™ ×ª×™×§×•×Ÿ
        function fixNotificationButton() {
            log('ğŸ”¨ ××ª×§×Ÿ ×›×¤×ª×•×¨ ×”×ª×¨××•×ª...', 'info');
            if (typeof showNotificationButtonImmediate === 'function') {
                showNotificationButtonImmediate();
                log('âœ… ×¤×•× ×§×¦×™×™×ª ×ª×™×§×•×Ÿ ×”×•×¤×¢×œ×”', 'success');
            } else {
                log('âŒ ×¤×•× ×§×¦×™×™×ª ×ª×™×§×•×Ÿ ×œ× ×–××™× ×”', 'error');
            }
        }

        async function resetServiceWorker() {
            log('ğŸ”„ ×××ª×—×œ Service Worker...', 'info');
            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (const registration of registrations) {
                    await registration.unregister();
                    log(`ğŸ—‘ï¸ Service Worker ×”×•×¡×¨: ${registration.scope}`, 'info');
                }
                log('âœ… ×›×œ ×”-Service Workers ×”×•×¡×¨×•', 'success');
            } catch (e) {
                log(`âŒ ×©×’×™××” ×‘××ª×—×•×œ Service Worker: ${e.message}`, 'error');
            }
        }

        async function requestPermissions() {
            log('ğŸ”’ ××‘×§×© ×”×¨×©××•×ª ×”×ª×¨××•×ª...', 'info');
            try {
                const permission = await Notification.requestPermission();
                log(`ğŸ“ ×ª×•×¦××”: ${permission}`, permission === 'granted' ? 'success' : 'warning');
                updateStatus('permission', permission === 'granted');
            } catch (e) {
                log(`âŒ ×©×’×™××” ×‘×‘×§×©×ª ×”×¨×©××•×ª: ${e.message}`, 'error');
            }
        }

        function clearAllNotifications() {
            log('ğŸ—‘ï¸ ×× ×§×” ××ª ×›×œ ×”×”×ª×¨××•×ª...', 'info');
            
            // × ×§×” ×”×ª×¨××•×ª jQuery
            if (typeof $ !== 'undefined') {
                $('.custom-notification').remove();
                log('âœ… ×”×ª×¨××•×ª jQuery × ×•×§×•', 'success');
            }
            
            // × ×§×” ×”×ª×¨××•×ª Vanilla
            const vanillaNotifications = document.querySelectorAll('.custom-notification');
            vanillaNotifications.forEach(n => n.remove());
            log(`âœ… ${vanillaNotifications.length} ×”×ª×¨××•×ª Vanilla × ×•×§×•`, 'success');
        }

        // ××ª×—×•×œ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ ××¨×›×– ×‘×“×™×§×ª ×”×ª×¨××•×ª ××•×›×Ÿ!', 'success');
            log('ğŸ’¡ ×œ×—×¥ ×¢×œ "×‘×“×™×§×ª ×¡×˜×˜×•×¡ ×›×œ×œ×™" ×›×“×™ ×œ×”×ª×—×™×œ', 'info');
            
            // ×‘×¦×¢ ×‘×“×™×§×” ××•×˜×•××˜×™×ª
            setTimeout(checkSystemStatus, 1000);
        });

    </script>
</body>
</html>
