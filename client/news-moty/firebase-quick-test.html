<!DOCTYPE html>
<html>
<head>
    <title>Quick Firebase Test</title>
    <script src="js/firebaseConfig.js"></script>
</head>
<body>
    <h1>Quick Firebase Connection Test</h1>
    <button onclick="testConnection()">Test Firebase Connection</button>
    <div id="result"></div>

    <script type="module">
        window.testConnection = async function() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                console.log('Firebase Config:', firebaseConfig);
                
                // Test Firebase app initialization
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js');
                const app = initializeApp(firebaseConfig);
                console.log('Firebase app initialized:', app.options.projectId);
                
                // Test messaging
                const { getMessaging, getToken, isSupported } = await import('https://www.gstatic.com/firebasejs/12.0.0/firebase-messaging.js');
                
                const supported = await isSupported();
                console.log('Messaging supported:', supported);
                
                if (supported) {
                    const messaging = getMessaging(app);
                    console.log('Messaging instance created');
                    
                    // Request permission
                    const permission = await Notification.requestPermission();
                    console.log('Notification permission:', permission);
                    
                    if (permission === 'granted') {
                        try {
                            const token = await getToken(messaging, { vapidKey });
                            console.log('FCM Token:', token);
                            resultDiv.innerHTML = `
                                <h3>✅ Success!</h3>
                                <p><strong>Project:</strong> ${app.options.projectId}</p>
                                <p><strong>Permission:</strong> ${permission}</p>
                                <p><strong>Token:</strong> ${token.substring(0, 50)}...</p>
                            `;
                        } catch (tokenError) {
                            console.error('Token error:', tokenError);
                            resultDiv.innerHTML = `
                                <h3>⚠️ Partial Success</h3>
                                <p><strong>Project:</strong> ${app.options.projectId}</p>
                                <p><strong>Permission:</strong> ${permission}</p>
                                <p><strong>Token Error:</strong> ${tokenError.message}</p>
                            `;
                        }
                    } else {
                        resultDiv.innerHTML = `
                            <h3>⚠️ Permission Issue</h3>
                            <p><strong>Project:</strong> ${app.options.projectId}</p>
                            <p><strong>Permission:</strong> ${permission}</p>
                            <p>Please allow notifications and try again.</p>
                        `;
                    }
                } else {
                    resultDiv.innerHTML = `
                        <h3>❌ Messaging Not Supported</h3>
                        <p>Firebase messaging is not supported in this browser/environment.</p>
                    `;
                }
                
            } catch (error) {
                console.error('Test failed:', error);
                resultDiv.innerHTML = `
                    <h3>❌ Test Failed</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>
